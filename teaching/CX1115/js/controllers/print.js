import{SLIDES_SELECTOR}from"../utils/constants.js";import{queryAll,createStyleSheet}from"../utils/util.js";export default class Print{constructor(e){this.Reveal=e}setupPDF(){let e=this.Reveal.getConfig(),t=this.Reveal.getComputedSlideSize(window.innerWidth,window.innerHeight),i=Math.floor(t.width*(1+e.margin)),s=Math.floor(t.height*(1+e.margin)),a=t.width,l=t.height;createStyleSheet("@page{size:"+i+"px "+s+"px; margin: 0px;}"),createStyleSheet(".reveal section>img, .reveal section>video, .reveal section>iframe{max-width: "+a+"px; max-height:"+l+"px}"),document.documentElement.classList.add("print-pdf"),document.body.style.width=i+"px",document.body.style.height=s+"px",this.Reveal.layoutSlideContents(a,l);let n=e.slideNumber&&/all|print/i.test(e.showSlideNumber);queryAll(this.Reveal.getRevealElement(),SLIDES_SELECTOR).forEach(function(e){e.setAttribute("data-slide-number",this.Reveal.slideNumber.getSlideNumber(e))},this),queryAll(this.Reveal.getRevealElement(),SLIDES_SELECTOR).forEach(function(t){if(!1===t.classList.contains("stack")){let r=(i-a)/2,o=(s-l)/2,d=t.scrollHeight,c=Math.max(Math.ceil(d/s),1);(1===(c=Math.min(c,e.pdfMaxPagesPerSlide))&&e.center||t.classList.contains("center"))&&(o=Math.max((s-d)/2,0));let h=document.createElement("div");if(h.className="pdf-page",h.style.height=(s+e.pdfPageHeightOffset)*c+"px",t.parentNode.insertBefore(h,t),h.appendChild(t),t.style.left=r+"px",t.style.top=o+"px",t.style.width=a+"px",t.slideBackgroundElement&&h.insertBefore(t.slideBackgroundElement,t),e.showNotes){let s=this.Reveal.getSlideNotes(t);if(s){let t=8,a="string"==typeof e.showNotes?e.showNotes:"inline",l=document.createElement("div");l.classList.add("speaker-notes"),l.classList.add("speaker-notes-pdf"),l.setAttribute("data-layout",a),l.innerHTML=s,"separate-page"===a?h.parentNode.insertBefore(l,h.nextSibling):(l.style.left=t+"px",l.style.bottom=t+"px",l.style.width=i-2*t+"px",h.appendChild(l))}}if(n){let e=document.createElement("div");e.classList.add("slide-number"),e.classList.add("slide-number-pdf"),e.innerHTML=t.getAttribute("data-slide-number"),h.appendChild(e)}if(e.pdfSeparateFragments){let e,t,i=this.Reveal.fragments.sort(h.querySelectorAll(".fragment"),!0);i.forEach(function(i){e&&e.forEach(function(e){e.classList.remove("current-fragment")}),i.forEach(function(e){e.classList.add("visible","current-fragment")},this);let s=h.cloneNode(!0);h.parentNode.insertBefore(s,(t||h).nextSibling),e=i,t=s},this),i.forEach(function(e){e.forEach(function(e){e.classList.remove("visible","current-fragment")})})}else queryAll(h,".fragment:not(.fade-out)").forEach(function(e){e.classList.add("visible")})}},this),this.Reveal.dispatchEvent({type:"pdf-ready"})}isPrintingPDF(){return/print-pdf/gi.test(window.location.search)}};