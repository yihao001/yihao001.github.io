import speakerViewHTML from"./speaker-view.html";import marked from"marked";const Plugin=()=>{function e(){function e(){let e=setInterval(function(){n.postMessage(JSON.stringify({namespace:"reveal-notes",type:"connect",url:window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,state:t.getState()}),"*")},500);window.addEventListener("message",function(t){let n=JSON.parse(t.data);n&&"reveal-notes"===n.namespace&&"connected"===n.type&&(clearInterval(e),r()),n&&"reveal-notes"===n.namespace&&"call"===n.type&&a(n.methodName,n.arguments,n.callId)})}function a(e,a,o){let r=t[e].apply(t,a);n.postMessage(JSON.stringify({namespace:"reveal-notes",type:"return",result:r,callId:o}),"*")}function o(){let e=t.getCurrentSlide(),a=e.querySelector("aside.notes"),o=e.querySelector(".current-fragment"),r={namespace:"reveal-notes",type:"state",notes:"",markdown:!1,whitespace:"normal",state:t.getState()};if(e.hasAttribute("data-notes")&&(r.notes=e.getAttribute("data-notes"),r.whitespace="pre-wrap"),o){let e=o.querySelector("aside.notes");e?a=e:o.hasAttribute("data-notes")&&(r.notes=o.getAttribute("data-notes"),r.whitespace="pre-wrap",a=null)}a&&(r.notes=a.innerHTML,r.markdown="string"==typeof a.getAttribute("data-markdown")),n.postMessage(JSON.stringify(r),"*")}function r(){t.on("slidechanged",o),t.on("fragmentshown",o),t.on("fragmenthidden",o),t.on("overviewhidden",o),t.on("overviewshown",o),t.on("paused",o),t.on("resumed",o),o()}!n||n.closed?((n=window.open("about:blank","reveal.js - Notes","width=1100,height=700")).marked=marked,n.document.write(speakerViewHTML),n?e():alert("Speaker view popup failed to open. Please make sure popups are allowed and reopen the speaker view.")):n.focus()}let t,n=null;return{id:"notes",init:function(n){t=n,/receiver/i.test(window.location.search)||(null!==window.location.search.match(/(\?|\&)notes/gi)&&e(),t.addKeyBinding({keyCode:83,key:"S",description:"Speaker notes view"},function(){e()}))},open:e}};export default Plugin;